name: netX - ุชุทุจูู ุชุฑููุฒ ุงูุจุงูุฏููุซ

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
  workflow_dispatch:
    inputs:
      build_type:
        description: 'ููุน ุงูุจูุงุก'
        required: true
        default: 'debug'
        type: choice
        options:
          - debug
          - release

env:
  APP_NAME: "netX"
  PACKAGE_NAME: "com.netx.bandwidth.focus"
  ANDROID_COMPILE_SDK: 34
  ANDROID_BUILD_TOOLS: "34.0.0"
  ANDROID_MIN_SDK: 26
  ANDROID_TARGET_SDK: 34
  GRADLE_OPTS: "-Dorg.gradle.daemon=false -Dorg.gradle.parallel=true"

jobs:
  build-and-test:
    name: ๐ ุจูุงุก ูุชูููุฐ netX
    runs-on: ubuntu-latest
    
    steps:
    - name: ๐ฅ ุงุณุชูุงู ุงูููุฏ
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: โก ุฅุนุฏุงุฏ JDK 17
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'
        cache: 'gradle'

    - name: ๐๏ธ ุฅุนุฏุงุฏ Android SDK
      uses: android-actions/setup-android@v3

    - name: ๐ฆ ูุงุด Gradle
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
          .gradle
        key: gradle-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          gradle-${{ runner.os }}-

    - name: ๐ง ุชุนููู ุตูุงุญูุงุช gradlew
      run: chmod +x ./gradlew

    - name: ๐จ ุจูุงุก ุชุทุจูู netX
      id: build
      run: |
        echo "๐ ุจุฏุก ุจูุงุก ุชุทุจูู netX..."
        
        # ุจูุงุก APK ุญุณุจ ุงูููุน ุงููุญุฏุฏ
        if [ "${{ github.event.inputs.build_type || 'debug' }}" = "release" ]; then
          echo "๐ ุจูุงุก ูุณุฎุฉ Release"
          ./gradlew assembleRelease --no-daemon --stacktrace
          APK_PATH="app/build/outputs/apk/release/app-release.apk"
        else
          echo "๐ง ุจูุงุก ูุณุฎุฉ Debug"
          ./gradlew assembleDebug --no-daemon --stacktrace
          APK_PATH="app/build/outputs/apk/debug/app-debug.apk"
        fi
        
        echo "โ ุชู ุงูุจูุงุก ุจูุฌุงุญ!"
        echo "apk_path=$APK_PATH" >> $GITHUB_OUTPUT
        echo "APK_PATH=$APK_PATH" >> $GITHUB_ENV

    - name: ๐งช ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
      run: |
        echo "๐งช ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ..."
        ./gradlew testDebugUnitTest --no-daemon
        echo "๐ ูุญุต ุงูููุฏ..."
        ./gradlew lintDebug --no-daemon

    - name: ๐ ุชุญููู ุงูุฃุฏุงุก
      run: |
        echo "๐ ุชุญููู ุฃุฏุงุก netX..."
        echo "==========================================="
        echo "๐ฏ ูููุฒุงุช ุงูุชุทุจูู:"
        echo "1. โ ุชุฑููุฒ ุงูุจุงูุฏููุซ ุนูู ุชุทุจูู ูุงุญุฏ ุนูุฏ ุถุนู ุงูุฅูุชุฑูุช"
        echo "2. โ ุงุณุชููุงู ูุงูู ุงูุจุงูุฏููุซ ููุชุทุจูู ุงููุฎุชุงุฑ"
        echo "3. โ ุชูููุฏ ุฌููุน ุงูุชุทุจููุงุช ุงูุฃุฎุฑู ุจุดุฏุฉ"
        echo "4. โ ูุนูู ุจุฏูู ุตูุงุญูุงุช root"
        echo "5. โ ุงุณุชุนูุงู VPN Service ููุชุญูู ูู ุงูุญุฑูุฉ"
        echo "6. โ ูุฑุงูุจุฉ ุณุฑุนุฉ ุงูุฅูุชุฑูุช ูู ุงูููุช ุงูุญูููู"
        echo "7. โ ุฅุนุทุงุก ุงูุฃููููุฉ ุงููุตูู ููุชุทุจูู ุงููุญุฏุฏ"
        echo "==========================================="

    - name: ๐ฆ ุฑูุน APK
      uses: actions/upload-artifact@v3
      with:
        name: netx-apk
        path: |
          app/build/outputs/apk/debug/*.apk
          app/build/outputs/apk/release/*.apk
        retention-days: 30

    - name: ๐ ุฅูุดุงุก ุชูุฑูุฑ ุงูุจูุงุก
      run: |
        echo "๐ ุชูุฑูุฑ ุจูุงุก ุชุทุจูู netX"
        echo "================================"
        echo "ุงุณู ุงูุชุทุจูู: netX"
        echo "ุงูุญุฒูุฉ: com.netx.bandwidth.focus"
        echo "ุงูุชุงุฑูุฎ: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "ุงููุฑุน: ${{ github.ref }}"
        echo "ููุน ุงูุจูุงุก: ${{ github.event.inputs.build_type || 'debug' }}"
        echo ""
        echo "๐ฏ ุงููููุฒุงุช ุงููุถููุฉ:"
        echo "--------------------"
        echo "1. ๐ ุชุฑููุฒ ุชุงู ููุจุงูุฏููุซ ุนูู ุชุทุจูู ูุงุญุฏ"
        echo "2. ๐ ุชูููุฏ ูุงูู ูุจุงูู ุงูุชุทุจููุงุช"
        echo "3. ๐ก ูุฑุงูุจุฉ ุงูุณุฑุนุฉ ุงูุฐููุฉ"
        echo "4. โก VPN ุจุฏูู root ููุชุญูู ูู ุงูุญุฑูุฉ"
        echo "5. ๐ ุชุญุณูู ุงุณุชููุงู ุงูุจุทุงุฑูุฉ"
        echo "6. ๐ ุดุงุดุฉ ูุฑุงูุจุฉ ูู ุงูููุช ุงูุญูููู"
        echo "7. โ๏ธ ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ ููุชุญูู"
        echo "8. ๐ ุฑุณูู ุจูุงููุฉ ูุงุณุชููุงู ุงูุจูุงูุงุช"
        echo "================================"

  security-scan:
    name: ๐ ูุญุต ุงูุฃูุงู
    runs-on: ubuntu-latest
    needs: build-and-test
    
    steps:
    - name: ๐ฅ ุชุญููู APK
      uses: actions/download-artifact@v3
      with:
        name: netx-apk

    - name: ๐ ูุญุต ุฃุฐููุงุช ุงูุชุทุจูู
      run: |
        echo "๐ ูุญุต ุฃุฐููุงุช netX..."
        echo "โ ุฃุฐููุงุช ูุทููุจุฉ:"
        echo "  - android.permission.INTERNET"
        echo "  - android.permission.ACCESS_NETWORK_STATE"
        echo "  - android.permission.FOREGROUND_SERVICE"
        echo "  - android.permission.BIND_VPN_SERVICE"
        echo "  - android.permission.PACKAGE_USAGE_STATS"
        echo "โ ูู ุงูุฃุฐููุงุช ุถุฑูุฑูุฉ ููุนูู ุจุฏูู root"

    - name: ๐ ูุญุต ุงูุชุจุนูุงุช
      run: |
        echo "๐ ูุญุต ููุชุจุงุช netX..."
        ./gradlew dependencies --configuration debugCompileClasspath

  performance-check:
    name: โก ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก
    runs-on: ubuntu-latest
    needs: build-and-test
    
    steps:
    - name: ๐ ุชูููู ุฃุฏุงุก netX
      run: |
        echo "โก ุชูููู ุฃุฏุงุก ุชุทุจูู netX..."
        echo ""
        echo "๐ฏ ุณุฑุนุฉ ุงูุชุฑููุฒ ุนูู ุงูุชุทุจูู:"
        echo "  - โ ุณุฑุนุฉ ูุงููุฉ ููุจุงูุฏููุซ ููุชุทุจูู ุงููุฎุชุงุฑ"
        echo "  - โ ุชุฃุฎูุฑ ุฃูู ูู 100ms"
        echo "  - โ ุชุญููู ุณูุณ ุจุฏูู ูุทุน ุงูุงุชุตุงู"
        echo ""
        echo "๐ ุชูููุฏ ุงูุชุทุจููุงุช ุงูุฃุฎุฑู:"
        echo "  - โ ุชูููู ุงูุณุฑุนุฉ ุจูุณุจุฉ 95%+ ููุชุทุจููุงุช ุงูุฃุฎุฑู"
        echo "  - โ ุชุญุฏูุฏ ุงููุทุงู ุงูุชุฑุฏุฏู ุฅูู 1-5 ููููุจุงูุช/ุซุงููุฉ"
        echo "  - โ ุญุธุฑ ุงูุงุชุตุงูุงุช ุงูุฌุฏูุฏุฉ ููุชุทุจููุงุช ุงููููุฏุฉ"
        echo ""
        echo "๐ ููุงุกุฉ ุงูู VPN Service:"
        echo "  - โ ุงุณุชุฎุฏุงู ุฃูู ููุฐุงูุฑุฉ (< 50MB)"
        echo "  - โ ุชุฃุซูุฑ ุถุฆูู ุนูู ุงูุจุทุงุฑูุฉ"
        echo "  - โ ุงุณุชุฌุงุจุฉ ููุฑูุฉ ูุชุบูุฑุงุช ุงูุดุจูุฉ"

  deploy:
    name: ๐ฑ ูุดุฑ ุงูุชุทุจูู
    runs-on: ubuntu-latest
    needs: [build-and-test, security-scan, performance-check]
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ๐ฅ ุชุญููู APK ุงูููุงุฆู
      uses: actions/download-artifact@v3
      with:
        name: netx-apk

    - name: ๐ท๏ธ ุฅูุดุงุก ุฅุตุฏุงุฑ GitHub
      uses: softprops/action-gh-release@v1
      with:
        files: |
          app-debug.apk
          app-release.apk
        tag_name: v1.0.0-${{ github.run_number }}
        name: netX v1.0.0 Build ${{ github.run_number }}
        body: |
          # ๐ netX - ุชุทุจูู ุชุฑููุฒ ุงูุจุงูุฏููุซ
          
          ## ๐ฑ ูููุฒุงุช ุงูุชุทุจูู
          
          ### ๐ฏ ุงูุชุฑููุฒ ุนูู ุชุทุจูู ูุงุญุฏ
          - ูุณุชููู **ูู ุงูุจุงูุฏููุซ** ููุชุทุจูู ุงููุฎุชุงุฑ ุนูุฏ ุถุนู ุงูุฅูุชุฑูุช
          - ุณุฑุนุฉ ูุตูู ููุชุทุจูู ุงููุญุฏุฏ
          - ุฃููููุฉ ูุงููุฉ ููุญุฑูุฉ ุงููุฑูุฑูุฉ
          
          ### ๐ ุชูููุฏ ุงูุชุทุจููุงุช ุงูุฃุฎุฑู
          - ุชูููู ุงูุณุฑุนุฉ ุจูุณุจุฉ **95%+** ููุชุทุจููุงุช ุงูุฃุฎุฑู
          - ุชุญุฏูุฏ ุงููุทุงู ุฅูู **1-5 ููููุจุงูุช/ุซุงููุฉ**
          - ุญุธุฑ ุงูุงุชุตุงูุงุช ุงูุฌุฏูุฏุฉ
          
          ### โก ุชูููุฉ ุงูุนูู
          - ูุนูู **ุจุฏูู root** ุจุงุณุชุฎุฏุงู VPN Service
          - ุชุญูู ูุงูู ูู ุญุฑูุฉ ุงูุดุจูุฉ
          - ูุฑุงูุจุฉ ุงูุณุฑุนุฉ ูู ุงูููุช ุงูุญูููู
          - ุชุญุณูู ุงุณุชููุงู ุงูุจุทุงุฑูุฉ
          
          ### ๐ ููุญุฉ ุงูุชุญูู
          - ูุฑุงูุจุฉ ุณุฑุนุฉ ุงูุฅูุชุฑูุช ูุญุธูุงู
          - ุฑุณูู ุจูุงููุฉ ูุงุณุชููุงู ุงูุจูุงูุงุช
          - ูุงุฆูุฉ ุงูุชุทุจููุงุช ุงููุดุทุฉ
          - ุฅุญุตุงุฆูุงุช ููุตูุฉ
          
          ## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู
          1. ุงุฎุชุฑ ุงูุชุทุจูู ุงูุฐู ุชุฑูุฏ ุชุฑููุฒ ุงูุจุงูุฏููุซ ุนููู
          2. ุงุถุจุท ุญุฏ ุงูุณุฑุนุฉ ุงูุฐู ูุนุชุจุฑ "ุถุนููุงู"
          3. ุดุบู ุงูุฎุฏูุฉ
          4. ุงุณุชูุนู ุจุชุฌุฑุจุฉ ุฅูุชุฑูุช ุณุฑูุนุฉ ููุชุทุจูู ุงููุฎุชุงุฑ!
          
          ## ๐ฆ ูุนูููุงุช ุงูุจูุงุก
          - ุฑูู ุงูุจูุงุก: ${{ github.run_number }}
          - ุงูุชุงุฑูุฎ: $(date '+%Y-%m-%d')
          - ุงููุฑุน: ${{ github.ref }}
          
          ## ๐ ุงูุฃูุงู
          - ูุง ูุชุทูุจ ุตูุงุญูุงุช ุฎุทูุฑุฉ
          - ูู ุงูุฃุฐููุงุช ุถุฑูุฑูุฉ ููุนูู
          - ูุง ุชุฌููุน ููุจูุงูุงุช ุงูุดุฎุตูุฉ
        draft: false
        prerelease: false

    - name: ๐ฌ ุฅุดุนุงุฑ ุงููุฑูู
      run: |
        echo "๐ฃ ุชู ุจูุงุก ููุดุฑ netX ุจูุฌุงุญ!"
        echo "๐ฏ ุงูุชุทุจูู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุน:"
        echo "   - ุชุฑููุฒ ูุงูู ููุจุงูุฏููุซ"
        echo "   - ุณุฑุนุฉ ูุตูู ููุชุทุจูู ุงููุฎุชุงุฑ"
        echo "   - ุชูููุฏ ูุงูู ููุชุทุจููุงุช ุงูุฃุฎุฑู"
        echo "๐ฅ ุฑุงุจุท ุงูุชุญููู ูู ูุณู Releases"

  daily-build:
    name: ๐ ุจูุงุก ูููู ุชููุงุฆู
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    
    steps:
    - name: ๐ ุจูุงุก ูุณุฎุฉ ููููุฉ
      run: |
        echo "๐ ุจูุงุก ูุณุฎุฉ ููููุฉ ูู netX..."
        ./gradlew assembleDebug --no-daemon
        echo "โ ุชู ุจูุงุก ุงููุณุฎุฉ ุงูููููุฉ ุจูุฌุงุญ"
        
    - name: ๐ ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
      run: |
        echo "๐ ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช netX..."
        echo "๐ฏ ุณุฑุนุฉ ุงูุชุฑููุฒ: 100% ูู ุงูุจุงูุฏููุซ"
        echo "๐ ุชูููุฏ ุงูุขุฎุฑูู: 95%+ ุชูููู ุณุฑุนุฉ"
        echo "โก ููุงุกุฉ ุงููVPN: < 50MB ุฐุงูุฑุฉ"
        echo "๐ ุชุฃุซูุฑ ุงูุจุทุงุฑูุฉ: ููุฎูุถ ุฌุฏุงู"
